% Copyright 2014 by Emmanuel Boidot <eboidot3@gatech.edu>
%
% This file may be distributed and/or modified
%
% 1. under the LaTeX Project Public License and/or
% 2. under the GNU Public License.
%
\mode<presentation>

\usetheme{Warsaw}
\useinnertheme[shadow=true]{rounded}
\setbeamertemplate{frametitle}[default][shadow=false]
\useoutertheme[subsection=false]{miniframes}
\setbeamertemplate{mini frame in other section}[default][20]
\setbeamertemplate{section/subsection in toc}[subsections numbered]
\usepackage{totcount}
\usepackage{tikz}

\newif\if@darkOption
\@darkOptionfalse
\DeclareOption{dark}{\@darkOptiontrue}

\newif\if@sectionTocOption
\@sectionTocOptionfalse
\DeclareOption{sectionToc}{\@sectionTocOptiontrue}

\newif\if@partTocOption
\@partTocOptionfalse
\DeclareOption{partToc}{\@partTocOptiontrue}

\ProcessOptions
% choose between dark and light colors
\if@darkOption
	\usecolortheme{buzz-dark}
\else
	\usecolortheme{buzz-light}
\fi

% for first toc
\newenvironment<>{tocblock}[1][]{%
	\if@darkOption
		\setbeamercolor{block title}{fg=white,bg=gtdarknavy}%
		\setbeamercolor{block body}{fg=white,bg=gtdarknavy}%
	\else
		\setbeamercolor{block title}{fg=white,bg=gtgold}%
		\setbeamercolor{block body}{fg=white,bg=gtgold}%
	\fi
  	\begin{block}{#1}#2}{\end{block}}
  
% for section toc
\newenvironment<>{sectiontocblock}[1][]{%
	\if@darkOption
		\setbeamercolor{block title}{fg=black,bg=gtdarknavy}%
		\setbeamercolor{block body}{fg=black,bg=white!85!bg!95!gtdarknavy}%white!85!bg!95!gtdarknavy
	\else
		\setbeamercolor{block title}{fg=gtgold,bg=gtgold}%
		\setbeamercolor{block body}{fg=gtdarknavy,bg=white!75!bg!90!gtgold}%
	\fi
  	\begin{block}{#1}#2}{\end{block}}

% if section table of content want, add sectionToc option to the theme
\if@sectionTocOption
	\AtBeginSection[]{%
	\begin{frame}
	\begin{columns}
		\begin{column}{.1\textwidth}
		\end{column}
		\begin{column}{.7\textwidth}
		  	%\frametitle{\insertsection}
			\setcounter{tocdepth}{2}
			\begin{sectiontocblock}{\insertpart}
			\begin{columns}
			\begin{column}{.05\textwidth}
			
			\end{column}
		  	\begin{column}{.95\textwidth}
		  	\tableofcontents[
		  		currentsection,
		  		%sectionstyle=hide/hide,
		  		subsectionstyle=show/show/hide
			]
		  	\end{column}
		  	\end{columns}
			\vspace*{.5em}
			\end{sectiontocblock}
		\end{column}
		\begin{column}{.1\textwidth}
		\end{column}
	\end{columns}
	\end{frame}
	}
\fi

\if@partTocOption
	% for the list of parts\parttitle
	\makeatletter
	\AtBeginPart{%
	    {
	    	\addtocontents{toc}{\protect\beamer@partintoc{\the\c@part}{\beamer@partname}{\the\c@page}}
			%\setbeamertemplate{headline}{}
			\begin{frame}
			\hypertarget{part\the\c@part}{}
			\partpage	
			\begin{columns}
			\begin{column}{.05\textwidth}
			
			\end{column}
			\begin{column}{.95\textwidth}
			\tableofcontents[
			  currentsection,
			  sectionstyle=show/show,
			  subsectionstyle=hide/hide/hide
			]
			\end{column}
			\end{columns}	
			\end{frame} 
		}
	}
	\makeatother
\else
	\makeatletter
	\AtBeginPart{%
		\addtocontents{toc}{\protect\beamer@partintoc{\the\c@part}{\beamer@partname}{\the\c@page}}%
		\hypertarget{part\the\c@part}{}
	}
	\makeatother
\fi

\makeatletter
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\makeatother

\makeatletter
%\newcommand{\parttableofcontents}{\@starttoc{parttoc}}
%\newcommand{\beamer@partintoc}[3]{#2\par}

% number, shortname, page.
\providecommand\beamer@partintoc[3]{%
  \ifnum\c@tocdepth=-1\relax
    % requesting onlyparts.
    \hyperlink{part#1}{\makebox[4em]{\rom{#1}} #2\vspace{1em}}
    % \hyperlink{\Navigation##1}{\makebox[3em]{#1} #2}
    \par
  \fi
}

\define@key{beamertoc}{onlyparts}[]{%
  \c@tocdepth=-1\relax
}
\makeatother%


\regtotcounter{section}
\newcounter{vertrules}

\setbeamerfont{block title}{size={}}
\let\Tiny=\tiny

%\setbeamertemplate{navigation symbols}{}

%\setbeamertemplate{headline}
%{%
%  \begin{beamercolorbox}[wd=\paperwidth,ht=2em]{myheadline}
%    \vskip1.5ex%
%    \insertsectionnavigationhorizontal{\paperwidth}{\hskip-0pt}{\hskip-0pt}\vskip2pt
%  \end{beamercolorbox}%
%  \setcounter{vertrules}{\totvalue{section}}
%  \ifnum\thevertrules<2 \else
%  \addtocounter{vertrules}{-1}
%  \fi%
%}

%\setbeamertemplate{section in head/foot}{%
%    \hspace*{-4pt}\setlength\fboxsep{0pt}%
%    \parbox[c][2ex][t]{\dimexpr\sectionboxwd\relax}{%
%      \hfill\parbox{\dimexpr\sectionboxwd\relax}{%
%      \raggedright\insertsectionhead%
%      }\hfill\mbox{}%
%    }\hspace*{4pt}%
%}
%\newlength\sectionboxwd
%
%\AtBeginDocument{%
%  \ifnum\totvalue{section}>0 
%    \setlength\sectionboxwd{\dimexpr\paperwidth/\totvalue{section}\relax}
%  \else
%    \setlength\sectionboxwd{\paperwidth}
%  \fi
%} 


\beamersetuncovermixins{\opaqueness<1>{10}}{\opaqueness<2->{5}}
%slide number
\setbeamertemplate{footline}{%
  \leavevmode%
  \hbox{\begin{beamercolorbox}[wd=.5\paperwidth,ht=2.5ex,dp=1.125ex,leftskip=.3cm plus1fill,rightskip=.3cm]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.5\paperwidth,ht=2.5ex,dp=1.125ex,leftskip=.3cm,rightskip=.3cm plus1fil]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle  \hfill\insertframenumber\strut\quad 
%/\inserttotalframenumber
  \end{beamercolorbox}}%
}

\usepackage{etoolbox} % this can cause issues with biblatex
\makeatletter
\patchcmd{\slideentry}{\advance\beamer@xpos by1\relax}{}{}{}
\def\beamer@subsectionentry#1#2#3#4#5{\advance\beamer@xpos by1\relax}%
\makeatother

\makeatletter
\setbeamertemplate{subsection in navigation}
  {\vspace*{-\baselineskip}}
\setbeamertemplate{subsection in navigation shaded}
  {\vspace*{-\baselineskip}}
\makeatother

%\AtBeginEnvironment{exampleblock}{%
%	\setbeamercolor{itemize item}{fg=gtgold,bg=gtgold}
%	\setbeamercolor{itemize subitem}{fg=gtgold,bg=gtgold}
%	\setbeamercolor{itemize subsubitem}{fg=gtgold,bg=gtgold}
%}

\logo{\includegraphics[width=0.2\textwidth]{logoGT.PNG}}

\mode <all>
